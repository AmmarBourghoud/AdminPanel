{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React,{Component}from'react';import{Badge,Card,CardBody,CardHeader,Col,Row,Table}from'reactstrap';import wretch from'wretch';import Moment from'moment';import mapboxgl from'mapbox-gl';import{relative}from'path';var SignalsMap=/*#__PURE__*/function(_Component){_inherits(SignalsMap,_Component);var _super=_createSuper(SignalsMap);function SignalsMap(props){var _this;_classCallCheck(this,SignalsMap);_this=_super.call(this,props);_this._isMounted=false;_this.loadSignal=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:return _context.abrupt(\"return\",new Promise(function(resolve,reject){if(_this._isMounted)_this.setState({isLoading:true});wretch().url(\"http://localhost:8080/signal\").get().json(function(res){if(_this._isMounted)_this.setState({isLoading:false,items:res});resolve(res);}).catch(function(err){console.log('err',err);reject();});}));case 1:case\"end\":return _context.stop();}}},_callee);}));_this.state={items:{},isLoading:false};return _this;}_createClass(SignalsMap,[{key:\"componentDidMount\",value:function(){var _componentDidMount=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var res,map;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:this._isMounted=true;_context3.next=3;return this.loadSignal();case 3:res=_context3.sent;mapboxgl.accessToken='pk.eyJ1IjoiY2VjZW5uYmwiLCJhIjoiY2szNGo3MHhxMDlqbTNwbzRtM2JnMG9iMiJ9.jPHdv3qcnvmAqe69UlA8LQ';map=new mapboxgl.Map({container:this.Mapcontainer,style:'mapbox://styles/mapbox/streets-v9',center:[2.4159,48.7651],zoom:13});map.on(\"load\",function(){map.loadImage(\"https://i.imgur.com/MK4NUzI.png\",/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(error,image){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!error){_context2.next=2;break;}throw error;case 2:_context2.next=4;return res.forEach(function(sig){map.addImage(sig._id,image);map.addLayer({id:sig._id,type:\"symbol\",source:{type:\"geojson\",data:{type:'FeatureCollection',features:[{type:'Feature',properties:{\"description\":\"<strong>\"+sig.name+\"</strong><p>\"+sig.description+\"</p> <p>Date: \"+Moment(sig.created_date).format('DD/MM/YY Ã  HH:mm')+\"</p> <p><a href='\"+\"/signal/\".concat(sig._id,\"/\")+\"'><em>Voir la fiche du signalement</em></a> </p>\"},geometry:{type:\"Point\",coordinates:[sig.localization.long,sig.localization.lat]}}]}},layout:{\"icon-image\":sig._id,\"icon-allow-overlap\":true}});map.on('click',sig._id,function(e){var coordinates=e.features[0].geometry.coordinates.slice();var description=e.features[0].properties.description;while(Math.abs(e.lngLat.lng-coordinates[0])>180){coordinates[0]+=e.lngLat.lng>coordinates[0]?360:-360;}new mapboxgl.Popup().setLngLat(coordinates).setHTML(description).addTo(map);});});case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x,_x2){return _ref2.apply(this,arguments);};}());});case 7:case\"end\":return _context3.stop();}}},_callee3,this);}));function componentDidMount(){return _componentDidMount.apply(this,arguments);}return componentDidMount;}()},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}},{key:\"componentDidUpdate\",value:function(){var _componentDidUpdate=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(prevProps,prevState,snapshot){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!(prevProps.match.params.id!==this.props.match.params.id)){_context4.next=3;break;}_context4.next=3;return this.loadSignal();case 3:case\"end\":return _context4.stop();}}},_callee4,this);}));function componentDidUpdate(_x3,_x4,_x5){return _componentDidUpdate.apply(this,arguments);}return componentDidUpdate;}()},{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/React.createElement(\"div\",{className:\"animated fadeIn\"},/*#__PURE__*/React.createElement(Row,null,/*#__PURE__*/React.createElement(Col,{lg:12},/*#__PURE__*/React.createElement(Card,null,/*#__PURE__*/React.createElement(CardHeader,{className:\"card card-accent-warning mb-3\"},/*#__PURE__*/React.createElement(\"strong\",null,/*#__PURE__*/React.createElement(\"i\",{className:\"icon-info pr-1\"}),\"Localisation\")),/*#__PURE__*/React.createElement(CardBody,null,/*#__PURE__*/React.createElement(\"div\",{className:\"FullMap\",ref:function ref(x){_this2.Mapcontainer=x;}}))))));}}]);return SignalsMap;}(Component);export default SignalsMap;","map":{"version":3,"sources":["C:/Users/abourgho/Desktop/ETNA/GPE/group-690338/AdminPanel/src/views/Signals/SignalsMap.js"],"names":["React","Component","Badge","Card","CardBody","CardHeader","Col","Row","Table","wretch","Moment","mapboxgl","relative","SignalsMap","props","_isMounted","loadSignal","Promise","resolve","reject","setState","isLoading","url","get","json","res","items","catch","err","console","log","state","accessToken","map","Map","container","Mapcontainer","style","center","zoom","on","loadImage","error","image","forEach","sig","addImage","_id","addLayer","id","type","source","data","features","properties","name","description","created_date","format","geometry","coordinates","localization","long","lat","layout","e","slice","Math","abs","lngLat","lng","Popup","setLngLat","setHTML","addTo","prevProps","prevState","snapshot","match","params","x"],"mappings":"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","sourcesContent":["\r\nimport React, { Component } from 'react';\r\nimport {Badge, Card, CardBody, CardHeader, Col, Row, Table} from 'reactstrap';\r\nimport wretch from 'wretch';\r\nimport Moment from 'moment';\r\nimport mapboxgl from 'mapbox-gl'\r\nimport { relative } from 'path';\r\n\r\n\r\nclass SignalsMap extends Component {\r\n  _isMounted = false;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      items: {},\r\n      isLoading: false\r\n    };\r\n  }\r\n\r\n  async componentDidMount() {\r\n    this._isMounted = true;\r\n    const res = await this.loadSignal();\r\n\r\n    mapboxgl.accessToken = 'pk.eyJ1IjoiY2VjZW5uYmwiLCJhIjoiY2szNGo3MHhxMDlqbTNwbzRtM2JnMG9iMiJ9.jPHdv3qcnvmAqe69UlA8LQ';\r\n\r\n    var map = new mapboxgl.Map({\r\n      container: this.Mapcontainer,\r\n      style: 'mapbox://styles/mapbox/streets-v9',\r\n      center: [2.4159, 48.7651],\r\n      zoom: 13\r\n    });\r\n\r\n    map.on(\"load\", function () {\r\n          map.loadImage(\"https://i.imgur.com/MK4NUzI.png\", async function(error, image) {\r\n          if (error) throw error;\r\n          await res.forEach(\r\n            sig => {\r\n            map.addImage(sig._id, image);\r\n            map.addLayer({\r\n              id: sig._id,\r\n              type: \"symbol\",\r\n              source: {\r\n                type: \"geojson\",\r\n                data: {\r\n                  type: 'FeatureCollection',\r\n                  features: [\r\n                    {\r\n                      type: 'Feature',\r\n                      properties: {\r\n                        \"description\":\"<strong>\"+ sig.name +\"</strong><p>\"+\r\n                        sig.description + \"</p> <p>Date: \"+ Moment(sig.created_date).format('DD/MM/YY Ã  HH:mm') +\r\n                        \"</p> <p><a href='\"+ `/signal/${sig._id}/` +\"'><em>Voir la fiche du signalement</em></a> </p>\"\r\n                      },\r\n                      geometry: {\r\n                      type: \"Point\",\r\n                      coordinates: [sig.localization.long, sig.localization.lat]\r\n                      }\r\n                    }\r\n                  ]\r\n                }\r\n              },\r\n              layout: {\r\n                \"icon-image\": sig._id,\r\n                \"icon-allow-overlap\": true\r\n              }\r\n            });\r\n            map.on('click', sig._id, function (e) {\r\n              var coordinates = e.features[0].geometry.coordinates.slice();\r\n              var description = e.features[0].properties.description;\r\n              while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\r\n              coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\r\n              }\r\n              new mapboxgl.Popup()\r\n              .setLngLat(coordinates)\r\n              .setHTML(description)\r\n              .addTo(map);\r\n              });\r\n            }\r\n          );\r\n        })\r\n      });\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this._isMounted = false;\r\n  }\r\n\r\n  async componentDidUpdate(prevProps, prevState, snapshot) {\r\n    if (prevProps.match.params.id !== this.props.match.params.id)\r\n      await this.loadSignal()\r\n  }\r\n\r\n  loadSignal = async () => {\r\n    return new Promise((resolve, reject) => {\r\n      if (this._isMounted)\r\n        this.setState({\r\n          isLoading: true\r\n        });\r\n      wretch()\r\n        .url(`http://localhost:8080/signal`)\r\n        .get()\r\n        .json(res => {\r\n          if (this._isMounted)\r\n           this.setState({\r\n            isLoading: false,\r\n            items: res,\r\n          });\r\n          resolve(res)\r\n        })\r\n        .catch(err => {\r\n          console.log('err', err);\r\n          reject()\r\n        })\r\n    })\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"animated fadeIn\">\r\n        <Row>\r\n          <Col lg={12}>\r\n            <Card>\r\n              <CardHeader className=\"card card-accent-warning mb-3\" >\r\n                <strong><i className=\"icon-info pr-1\"></i>Localisation</strong>\r\n              </CardHeader>\r\n              <CardBody>\r\n              <div className='FullMap' ref={(x) => { this.Mapcontainer = x }}></div>\r\n              </CardBody>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default SignalsMap;\r\n"]},"metadata":{},"sourceType":"module"}