{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";\nimport _classCallCheck from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";\nimport _createSuper from \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\Users\\\\abourgho\\\\Desktop\\\\ETNA\\\\GPE\\\\group-690338\\\\AdminPanel\\\\src\\\\views\\\\Signals\\\\SignalsMap.js\";\n\nimport React, { Component } from 'react';\nimport { Form, Button, Badge, Card, CardBody, CardHeader, Col, Row, Table } from 'reactstrap';\nimport wretch from 'wretch';\nimport Moment from 'moment';\nimport mapboxgl from 'mapbox-gl';\nimport { relative } from 'path';\nimport { MAP_TOKEN, MAP_IMAGE } from '../../api/paths/index';\nimport { loadSignalsToMap } from '../../api/functions/SignalsFunctions';\n\nvar mapInfos = function mapInfos() {\n  var map = new mapboxgl.Map({\n    container: _this.Mapcontainer,\n    style: 'mapbox://styles/mapbox/streets-v9',\n    center: [2.4159, 48.7651],\n    zoom: 13\n  });\n  return map;\n};\n\nvar SignalsMap = /*#__PURE__*/function (_Component) {\n  _inherits(SignalsMap, _Component);\n\n  var _super = _createSuper(SignalsMap);\n\n  function SignalsMap(props) {\n    var _this2;\n\n    _classCallCheck(this, SignalsMap);\n\n    _this2 = _super.call(this, props);\n    _this2._isMounted = false;\n\n    _this2.generateMap = function (response, map) {\n      console.log(\"trigged generateMap function\");\n      console.log(response);\n      mapboxgl.accessToken = MAP_TOKEN;\n      map.on(\"load\", function () {\n        map.loadImage(MAP_IMAGE, function (error, image) {\n          if (error) throw error;\n          response.forEach(function (signal) {\n            map.addImage(signal._id, image);\n            map.addLayer({\n              id: signal._id,\n              type: \"symbol\",\n              source: {\n                type: \"geojson\",\n                data: {\n                  type: 'FeatureCollection',\n                  features: [{\n                    type: 'Feature',\n                    properties: {\n                      \"description\": \"<strong>\" + signal.name + \"</strong><p>\" + signal.description + \"</p> <p>Date: \" + Moment(signal.created_date).format('DD/MM/YY à HH:mm') + \"</p> <p><a href='\" + \"#/signal/\".concat(signal._id, \"/\") + \"'><em>Voir la fiche du signalement</em></a> </p>\"\n                    },\n                    geometry: {\n                      type: \"Point\",\n                      coordinates: [signal.localization.long, signal.localization.lat]\n                    }\n                  }]\n                }\n              },\n              layout: {\n                \"icon-image\": signal._id,\n                \"icon-allow-overlap\": true\n              }\n            });\n            map.on('click', signal._id, function (e) {\n              var coordinates = e.features[0].geometry.coordinates.slice();\n              var description = e.features[0].properties.description;\n\n              while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\n                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\n              }\n\n              new mapboxgl.Popup().setLngLat(coordinates).setHTML(description).addTo(map);\n            });\n          });\n        });\n      });\n      map.remove();\n    };\n\n    _this2.state = {\n      items: {},\n      isLoading: false,\n      categoryValue: '',\n      statusValue: ''\n    };\n    _this2.handleChange = _this2.handleChange.bind(_assertThisInitialized(_this2));\n    _this2.handleSubmit = _this2.handleSubmit.bind(_assertThisInitialized(_this2));\n    return _this2;\n  }\n\n  _createClass(SignalsMap, [{\n    key: \"handleChange\",\n    value: function handleChange(event) {\n      this.setState(_defineProperty({}, event.target.name, event.target.value));\n    }\n  }, {\n    key: \"handleSubmit\",\n    value: function handleSubmit(event) {\n      event.preventDefault();\n      var newState = this.state;\n      var result = [];\n\n      if (this.state.categoryValue !== '' || this.state.statusValue !== '') {\n        //faire else pour retourner newState etc\n        this.state.items.data.forEach(function (item, index) {\n          if (newState.categoryValue !== '' && newState.statusValue !== '') {\n            if (newState.categoryValue === item.category && newState.statusValue === item.status) result.push(newState.items.data[index]);\n          } else if (newState.categoryValue !== '' || newState.statusValue !== '') {\n            if (newState.categoryValue === item.category || newState.statusValue === item.status) result.push(newState.items.data[index]);\n          }\n        });\n        console.log(result);\n        this.generateMap(result);\n      } else {\n        console.log(newState.items.data);\n        this.generateMap(newState.items.data);\n      }\n    }\n  }, {\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _this3 = this;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                this._isMounted = true;\n                loadSignalsToMap().then(function (response) {\n                  if (_this3._isMounted) _this3.setState({\n                    isLoading: true\n                  });\n\n                  if (response) {\n                    _this3.setState({\n                      isLoading: false,\n                      items: response\n                    });\n\n                    _this3.generateMap(response.data, mapInfos());\n\n                    console.log(response.data);\n                    console.log(_this3.state);\n                  }\n                });\n\n              case 2:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      this._isMounted = false;\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function () {\n      var _componentDidUpdate = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(prevProps, prevState, snapshot) {\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(prevProps.match.params.id !== this.props.match.params.id)) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                _context2.next = 3;\n                return this.loadSignal();\n\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function componentDidUpdate(_x, _x2, _x3) {\n        return _componentDidUpdate.apply(this, arguments);\n      }\n\n      return componentDidUpdate;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this4 = this;\n\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"animated fadeIn\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 7\n        }\n      }, /*#__PURE__*/React.createElement(Row, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(Col, {\n        lg: 12,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 155,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(Card, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 156,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(CardHeader, {\n        className: \"card card-accent-warning mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 157,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"strong\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"i\", {\n        className: \"icon-info pr-1\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 158,\n          columnNumber: 25\n        }\n      }), \"Localisation\"), /*#__PURE__*/React.createElement(\"div\", {\n        class: \"dropdown\",\n        style: {\n          display: 'inline-block'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 159,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(Form, {\n        noValidate: true,\n        onSubmit: this.handleSubmit,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 160,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"select\", {\n        name: \"statusValue\",\n        value: this.state.statusValue,\n        onChange: this.handleChange,\n        className: \"form-select form-select-lg mb-3\",\n        style: {\n          marginLeft: '20%',\n          fontWeight: 'bold',\n          fontFamily: 'cursive',\n          border: '3px solid transparent'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 161,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 162,\n          columnNumber: 17\n        }\n      }, \"Afficher par status de signalement\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Ouvert\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 17\n        }\n      }, \"Ouvert\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Termin\\xE9\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 17\n        }\n      }, \"Termin\\xE9\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"En Attente\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 17\n        }\n      }, \"En Attente\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"En Cours\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 166,\n          columnNumber: 17\n        }\n      }, \"En Cours\")), /*#__PURE__*/React.createElement(\"select\", {\n        name: \"categoryValue\",\n        value: this.state.categoryValue,\n        onChange: this.handleChange,\n        className: \"form-select form-select-sm\",\n        style: {\n          marginLeft: '15%',\n          fontWeight: 'bold',\n          fontFamily: 'cursive',\n          border: '3px solid transparent'\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 168,\n          columnNumber: 17\n        }\n      }, /*#__PURE__*/React.createElement(\"option\", {\n        value: \"\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 17\n        }\n      }, \"Afficher par categorie de signalement\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Propret\\xE9\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 170,\n          columnNumber: 17\n        }\n      }, \"Propret\\xE9\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"Panne\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 17\n        }\n      }, \"Panne\"), /*#__PURE__*/React.createElement(\"option\", {\n        value: \"D\\xE9gradation\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 172,\n          columnNumber: 17\n        }\n      }, \"D\\xE9gradation\")), /*#__PURE__*/React.createElement(Button, {\n        color: \"success\",\n        type: \"submit\",\n        block: true,\n        style: {\n          width: '20%',\n          marginLeft: \"43%\"\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 17\n        }\n      }, \"Lancer recherche\")))), /*#__PURE__*/React.createElement(CardBody, {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"FullMap\",\n        ref: function ref(x) {\n          _this4.Mapcontainer = x;\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 15\n        }\n      }))))));\n    }\n  }]);\n\n  return SignalsMap;\n}(Component);\n\nexport default SignalsMap;","map":{"version":3,"sources":["C:/Users/abourgho/Desktop/ETNA/GPE/group-690338/AdminPanel/src/views/Signals/SignalsMap.js"],"names":["React","Component","Form","Button","Badge","Card","CardBody","CardHeader","Col","Row","Table","wretch","Moment","mapboxgl","relative","MAP_TOKEN","MAP_IMAGE","loadSignalsToMap","mapInfos","map","Map","container","Mapcontainer","style","center","zoom","SignalsMap","props","_isMounted","generateMap","response","console","log","accessToken","on","loadImage","error","image","forEach","signal","addImage","_id","addLayer","id","type","source","data","features","properties","name","description","created_date","format","geometry","coordinates","localization","long","lat","layout","e","slice","Math","abs","lngLat","lng","Popup","setLngLat","setHTML","addTo","remove","state","items","isLoading","categoryValue","statusValue","handleChange","bind","handleSubmit","event","setState","target","value","preventDefault","newState","result","item","index","category","status","push","then","prevProps","prevState","snapshot","match","params","loadSignal","display","marginLeft","fontWeight","fontFamily","border","width","x"],"mappings":"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","sourcesContent":["\r\nimport React, { Component } from 'react';\r\nimport {Form,Button,Badge, Card, CardBody, CardHeader, Col, Row, Table} from 'reactstrap';\r\nimport wretch from 'wretch';\r\nimport Moment from 'moment';\r\nimport mapboxgl from 'mapbox-gl'\r\nimport { relative } from 'path';\r\nimport { MAP_TOKEN, MAP_IMAGE } from '../../api/paths/index'\r\nimport { loadSignalsToMap } from '../../api/functions/SignalsFunctions'\r\n\r\nconst mapInfos = () => {\r\n  var map = new mapboxgl.Map({\r\n    container: this.Mapcontainer,\r\n    style: 'mapbox://styles/mapbox/streets-v9',\r\n    center: [2.4159, 48.7651],\r\n    zoom: 13\r\n  });\r\n  return map\r\n}\r\n\r\nclass SignalsMap extends Component {\r\n  _isMounted = false;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      items: {},\r\n      isLoading: false,\r\n      categoryValue: '',\r\n      statusValue: ''\r\n    };\r\n    this.handleChange = this.handleChange.bind(this);\r\n    this.handleSubmit = this.handleSubmit.bind(this);\r\n  }\r\n\r\n  handleChange(event) {\r\n    this.setState({ [event.target.name]: event.target.value })\r\n  }\r\n\r\n  handleSubmit(event) {\r\n    event.preventDefault()\r\n    const newState = this.state;\r\n    const result = [];\r\n    if(this.state.categoryValue !== '' || this.state.statusValue !== '') { //faire else pour retourner newState etc\r\n     this.state.items.data.forEach(function (item, index) {\r\n      if (newState.categoryValue !== '' && newState.statusValue !== '') {\r\n        if(newState.categoryValue === item.category && newState.statusValue === item.status)\r\n            result.push(newState.items.data[index])\r\n          } else if (newState.categoryValue !== '' || newState.statusValue !== '') {\r\n            if(newState.categoryValue === item.category || newState.statusValue === item.status)\r\n              result.push(newState.items.data[index])\r\n          }\r\n     });\r\n     console.log(result);\r\n\r\n     this.generateMap(result)\r\n   } else {\r\n       console.log(newState.items.data);\r\n\r\n       this.generateMap(newState.items.data)\r\n     }\r\n  }\r\n\r\n  async componentDidMount() {\r\n    this._isMounted = true;\r\n\r\n    loadSignalsToMap().then(response => {\r\n      if (this._isMounted)\r\n        this.setState({\r\n          isLoading: true\r\n        });\r\n        if (response) {\r\n          this.setState({\r\n           isLoading: false,\r\n           items: response,\r\n         });\r\n        this.generateMap(response.data,mapInfos())\r\n        console.log(response.data);\r\n        console.log(this.state);\r\n          }\r\n      })\r\n\r\n  }\r\n\r\ngenerateMap = (response,map) => {\r\n  console.log(\"trigged generateMap function\");\r\n  console.log(response);\r\n  mapboxgl.accessToken = MAP_TOKEN;\r\n\r\n  map.on(\"load\", function () {\r\n        map.loadImage(MAP_IMAGE, function(error, image) {\r\n        if (error) throw error;\r\n        response.forEach(\r\n          signal => {\r\n          map.addImage(signal._id, image);\r\n          map.addLayer({\r\n            id: signal._id,\r\n            type: \"symbol\",\r\n            source: {\r\n              type: \"geojson\",\r\n              data: {\r\n                type: 'FeatureCollection',\r\n                features: [\r\n                  {\r\n                    type: 'Feature',\r\n                    properties: {\r\n                      \"description\":\"<strong>\"+ signal.name +\"</strong><p>\"+\r\n                      signal.description + \"</p> <p>Date: \"+ Moment(signal.created_date).format('DD/MM/YY à HH:mm') +\r\n                      \"</p> <p><a href='\"+ `#/signal/${signal._id}/` +\"'><em>Voir la fiche du signalement</em></a> </p>\"\r\n                    },\r\n                    geometry: {\r\n                    type: \"Point\",\r\n                    coordinates: [signal.localization.long, signal.localization.lat]\r\n                    }\r\n                  }\r\n                ]\r\n              }\r\n            },\r\n            layout: {\r\n              \"icon-image\": signal._id,\r\n              \"icon-allow-overlap\": true\r\n            }\r\n          });\r\n          map.on('click', signal._id, function (e) {\r\n            var coordinates = e.features[0].geometry.coordinates.slice();\r\n            var description = e.features[0].properties.description;\r\n            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {\r\n            coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;\r\n            }\r\n            new mapboxgl.Popup()\r\n            .setLngLat(coordinates)\r\n            .setHTML(description)\r\n            .addTo(map);\r\n            });\r\n          }\r\n        );\r\n      })\r\n    });\r\n    map.remove()\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this._isMounted = false;\r\n  }\r\n\r\n  async componentDidUpdate(prevProps, prevState, snapshot) {\r\n    if (prevProps.match.params.id !== this.props.match.params.id)\r\n      await this.loadSignal()\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"animated fadeIn\">\r\n        <Row>\r\n          <Col lg={12}>\r\n            <Card>\r\n              <CardHeader className=\"card card-accent-warning mb-3\" >\r\n                <strong><i className=\"icon-info pr-1\"></i>Localisation</strong>\r\n              <div class=\"dropdown\" style={{display: 'inline-block'}}>\r\n                <Form noValidate onSubmit={this.handleSubmit}>\r\n                <select name=\"statusValue\" value={this.state.statusValue} onChange={this.handleChange} className=\"form-select form-select-lg mb-3\" style={{marginLeft: '20%', fontWeight: 'bold', fontFamily: 'cursive', border: '3px solid transparent'}}>\r\n                <option value=\"\">Afficher par status de signalement</option>\r\n                <option value=\"Ouvert\">Ouvert</option>\r\n                <option value=\"Terminé\">Terminé</option>\r\n                <option value=\"En Attente\">En Attente</option>\r\n                <option value=\"En Cours\">En Cours</option>\r\n                </select>\r\n                <select name=\"categoryValue\" value={this.state.categoryValue} onChange={this.handleChange} className=\"form-select form-select-sm\" style={{marginLeft: '15%', fontWeight: 'bold', fontFamily: 'cursive', border: '3px solid transparent'}}>\r\n                <option value=\"\">Afficher par categorie de signalement</option>\r\n                <option value=\"Propreté\">Propreté</option>\r\n                <option value=\"Panne\">Panne</option>\r\n                <option value=\"Dégradation\">Dégradation</option>\r\n                </select>\r\n                <Button color=\"success\" type=\"submit\" block style={{width: '20%', marginLeft: \"43%\"}}>Lancer recherche</Button>\r\n                </Form>\r\n              </div>\r\n              </CardHeader>\r\n              <CardBody>\r\n              <div className='FullMap' ref={(x) => { this.Mapcontainer = x }}></div>\r\n              </CardBody>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default SignalsMap;\r\n"]},"metadata":{},"sourceType":"module"}