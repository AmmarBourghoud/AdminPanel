(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[18],{552:function(e,t,a){"use strict";a.r(t);var n=a(491),r=a.n(n),i=a(492),o=a(145),c=a(146),s=a(148),u=a(147),l=a(2),p=a.n(l),m=a(513),d=a(514),f=a(515),h=a(551),g=a(516),v=a(497),b=a(495),y=a.n(b),M=a(502),w=a.n(M),j=(a(503),function(e){Object(s.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e))._isMounted=!1,n.loadSignal=Object(i.a)(r.a.mark((function e(){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,t){n._isMounted&&n.setState({isLoading:!0}),Object(v.a)().url("http://localhost:8080/signal").get().json((function(t){n._isMounted&&n.setState({isLoading:!1,items:t}),e(t)})).catch((function(e){console.log("err",e),t()}))})));case 1:case"end":return e.stop()}}),e)}))),n.state={items:{},isLoading:!1},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=Object(i.a)(r.a.mark((function e(){var t,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._isMounted=!0,e.next=3,this.loadSignal();case 3:t=e.sent,w.a.accessToken="pk.eyJ1IjoiY2VjZW5uYmwiLCJhIjoiY2szNGo3MHhxMDlqbTNwbzRtM2JnMG9iMiJ9.jPHdv3qcnvmAqe69UlA8LQ",(a=new w.a.Map({container:this.Mapcontainer,style:"mapbox://styles/mapbox/streets-v9",center:[2.4159,48.7651],zoom:13})).on("load",(function(){a.loadImage("https://i.imgur.com/MK4NUzI.png",function(){var e=Object(i.a)(r.a.mark((function e(n,i){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n){e.next=2;break}throw n;case 2:return e.next=4,t.forEach((function(e){a.addImage(e._id,i),a.addLayer({id:e._id,type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",properties:{description:"<strong>"+e.name+"</strong><p>"+e.description+"</p> <p>Date: "+y()(e.created_date).format("DD/MM/YY \xe0 HH:mm")+"</p> <p><a href='"+"/signal/".concat(e._id,"/")+"'><em>Voir la fiche du signalement</em></a> </p>"},geometry:{type:"Point",coordinates:[e.localization.long,e.localization.lat]}}]}},layout:{"icon-image":e._id,"icon-allow-overlap":!0}}),a.on("click",e._id,(function(e){for(var t=e.features[0].geometry.coordinates.slice(),n=e.features[0].properties.description;Math.abs(e.lngLat.lng-t[0])>180;)t[0]+=e.lngLat.lng>t[0]?360:-360;(new w.a.Popup).setLngLat(t).setHTML(n).addTo(a)}))}));case 4:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}())}));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this._isMounted=!1}},{key:"componentDidUpdate",value:function(){var e=Object(i.a)(r.a.mark((function e(t,a,n){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.match.params.id===this.props.match.params.id){e.next=3;break}return e.next=3,this.loadSignal();case 3:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return p.a.createElement("div",{className:"animated fadeIn"},p.a.createElement(m.a,null,p.a.createElement(d.a,{lg:12},p.a.createElement(f.a,null,p.a.createElement(h.a,{className:"card card-accent-warning mb-3"},p.a.createElement("strong",null,p.a.createElement("i",{className:"icon-info pr-1"}),"Localisation")),p.a.createElement(g.a,null,p.a.createElement("div",{className:"FullMap",ref:function(t){e.Mapcontainer=t}}))))))}}]),a}(l.Component));t.default=j}}]);
//# sourceMappingURL=18.5a6837c2.chunk.js.map